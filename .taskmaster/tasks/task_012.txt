# Task ID: 12
# Title: Swiss-Compliant Invoicing System
# Status: pending
# Dependencies: 7, 8
# Priority: high
# Description: Develop an automated invoicing system with Swiss insurance-compatible templates, ASCA/RME credentials, and PDF generation with QR codes.
# Details:
Create invoice templates following Swiss insurance standards. Implement PDF generation using react-pdf or similar library. Add QR code generation for Swiss QR-bill format using qrcode.react. Integrate ASCA/RME credential auto-inclusion in invoices. Build invoice numbering and tracking system. Implement invoice status tracking (draft, sent, paid, overdue). Create automatic invoice generation after appointments. Add invoice history and search functionality. Implement invoice reminders via email. Create invoice analytics and reporting. Add invoice customization options for nutritionists. Implement batch invoice operations for efficiency.

# Test Strategy:
Unit tests for PDF generation and QR code creation. Integration tests for invoice CRUD operations. Visual regression testing for invoice templates. E2E tests for complete invoicing workflows. Test compliance with Swiss insurance requirements. Test email delivery of invoices and reminders.

# Subtasks:
## 1. Swiss Insurance-Compatible Template Design [pending]
### Dependencies: None
### Description: Create standardized invoice templates that comply with Swiss insurance requirements and include ASCA/RME credential fields
### Details:
Research and document Swiss insurance invoice requirements. Design template layouts with proper fields for service codes, provider information, and patient details. Include placeholders for ASCA/RME credentials. Create template variations for different insurance providers if needed. Ensure templates include all legally required information for Swiss healthcare invoices.

## 2. PDF Generation with QR Code Implementation [pending]
### Dependencies: 12.1
### Description: Implement PDF generation system using react-pdf with Swiss QR-bill format integration via qrcode.react
### Details:
Set up react-pdf library for invoice rendering. Implement qrcode.react for Swiss QR-bill format generation with proper payment information encoding. Create PDF layout components that match the designed templates. Ensure proper formatting of monetary values according to Swiss standards. Implement digital signature or verification features if required by regulations.

## 3. Invoice Management System [pending]
### Dependencies: 12.2
### Description: Build a comprehensive invoice tracking system with numbering, status management, and history functionality
### Details:
Implement sequential invoice numbering with configurable format. Create status tracking system (draft, sent, paid, overdue). Develop invoice history database with search and filter capabilities. Build invoice detail view with status change options. Implement invoice duplication and editing features with proper version control.

## 4. Automated Invoice Generation [pending]
### Dependencies: 12.3
### Description: Create system for automatic invoice generation after appointments with proper service code mapping
### Details:
Integrate with appointment system to trigger invoice creation. Implement service code mapping for different appointment types. Create configuration options for default pricing and services. Build batch processing for multiple appointments. Implement preview and approval workflow before finalization. Add manual adjustment capabilities for special cases.

## 5. Invoice Communication System [pending]
### Dependencies: 12.3, 12.4
### Description: Implement email delivery of invoices with reminder functionality and payment tracking
### Details:
Create email templates for invoice delivery with PDF attachments. Implement reminder scheduling system with configurable intervals. Build payment tracking integration with Stripe (Task 13). Develop analytics dashboard for invoice status and payment metrics. Create customizable email content for nutritionists. Implement batch operations for sending multiple invoices or reminders.

